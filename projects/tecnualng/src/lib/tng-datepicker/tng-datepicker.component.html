<div class="tng-datepicker-container" [class.focused]="isOpen()" [class.has-value]="formattedValue" [class.disabled]="disabled()">
  <!-- Trigger Field (Reusing Input Style) -->
  <div class="tng-input-trigger" (click)="toggleCalendar($event)">
    <fieldset class="tng-fieldset" aria-hidden="true">
      <legend class="tng-legend"><span>{{ label() }}</span></legend>
    </fieldset>
    <label class="tng-label">{{ label() }}</label>
    <input
      type="text"
      class="tng-input-display"
      [value]="formattedValue || (isOpen() ? '' : '')"
      [placeholder]="isOpen() ? placeholder() : ''"
      [disabled]="disabled()"
      (input)="onManualInput($event)"
      (click)="toggleCalendar($event)"
    />
    <i class="fa-solid fa-calendar tng-icon"></i>
  </div>

  <!-- Calendar Popup -->
  @if (isOpen()) {
    <div class="tng-calendar-popup">
      <div class="tng-calendar-header">
        <button type="button" class="nav-btn" (click)="prev($event)">
          <i class="fa-solid fa-chevron-left"></i>
        </button>
        <button type="button" class="header-label-btn" (click)="onHeaderClick()">
          {{ headerLabel }}
        </button>
        <button type="button" class="nav-btn" (click)="next($event)">
          <i class="fa-solid fa-chevron-right"></i>
        </button>
      </div>

      @switch (viewMode()) {
        @case ('day') {
          <div class="tng-calendar-grid">
            @for (day of daysOfWeek(); track day) {
              <div class="day-name">{{ day }}</div>
            }
            @for (date of calendarDays(); track date.getTime()) {
              <div
                class="day-cell"
                [class.not-current-month]="!isCurrentMonth(date)"
                [class.today]="isToday(date)"
                [class.selected]="isSelected(date)"
                [class.in-range]="isInRange(date)"
                [class.range-start]="mode() === 'range' && isSameDay(date, rangeValue.start)"
                [class.range-end]="mode() === 'range' && isSameDay(date, rangeValue.end)"
                [class.disabled]="isDisabled(date)"
                (click)="selectDate(date)"
              >
                {{ date.getDate() }}
              </div>
            }
          </div>
        }
        @case ('month') {
          <div class="tng-month-grid">
            @for (month of monthNames(); track $index) {
              <div 
                class="month-cell"
                [class.current]="currentViewDate().getMonth() === $index"
                (click)="selectMonth($index)"
              >
                {{ month.substring(0, 3) }}
              </div>
            }
          </div>
        }
        @case ('year') {
          <div class="tng-year-grid">
            @for (year of yearsList(); track year) {
              <div 
                class="year-cell"
                [class.current]="currentViewDate().getFullYear() === year"
                (click)="selectYear(year)"
              >
                {{ year }}
              </div>
            }
          </div>
        }
      }
    </div>
  }
</div>
